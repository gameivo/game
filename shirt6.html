<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Your Custom T-Shirt</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: white;
            box-shadow: var(--shadow);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            color: var(--secondary-color);
        }

        .logo span {
            color: var(--primary-color);
        }

        .nav-links {
            text-align: center;
            margin-top: 10px;
        }

        .nav-links a {
            color: var(--primary-color);
            text-decoration: none;
            margin: 0 15px;
            font-weight: 600;
        }

        .nav-links a:hover {
            text-decoration: underline;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin: 40px 0;
        }

        .design-area {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .t-shirt-container {
            position: relative;
            width: 100%;
            height: 500px;
            background-color: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #t-shirt-preview {
            position: relative;
            width: 300px;
            height: 400px;
        }

        .t-shirt-base {
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }

        #design-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            cursor: move;
        }

        .controls {
            flex: 0 0 300px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group h3 {
            margin-bottom: 15px;
            color: var(--secondary-color);
            font-size: 1.2rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }

        .color-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
        }

        .color-option.active {
            border-color: var(--primary-color);
            transform: scale(1.1);
        }

        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background-color: #fafafa;
            position: relative;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: #f0f8ff;
        }

        .upload-area.dragover {
            border-color: var(--primary-color);
            background-color: #e3f2fd;
            transform: scale(1.02);
        }

        .upload-area i {
            font-size: 2rem;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: block;
        }

        #design-upload {
            display: none;
        }

        .size-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .btn {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }

        .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-accent {
            background-color: var(--accent-color);
        }

        .btn-accent:hover {
            background-color: #c0392b;
        }

        .placement-controls {
            display: flex;
            gap: 10px;
        }

        .placement-controls .btn {
            flex: 1;
        }

        .form-section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: var(--shadow);
            margin-bottom: 40px;
        }

        .form-section h2 {
            margin-bottom: 20px;
            color: var(--secondary-color);
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            font-size: 1.1rem;
            margin-top: 10px;
        }

        footer {
            text-align: center;
            padding: 20px 0;
            color: #7f8c8d;
            border-top: 1px solid #eee;
            margin-top: 40px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background-color: #2ecc71;
            color: white;
            border-radius: 5px;
            box-shadow: var(--shadow);
            transform: translateX(150%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background-color: #e74c3c;
        }

        #design-preview {
            max-width: 100px;
            max-height: 100px;
            margin-top: 10px;
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .file-info {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9rem;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
            display: none;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        .upload-status {
            margin-top: 10px;
            font-size: 0.9rem;
            display: none;
        }

        .zoom-slider-container {
            margin-top: 15px;
        }

        .zoom-slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        .zoom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            transition: var(--transition);
        }

        .zoom-slider::-webkit-slider-thumb:hover {
            background: #2980b9;
            transform: scale(1.2);
        }

        .zoom-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
        }

        .zoom-values {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 0.8rem;
            color: #666;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .controls {
                order: -1;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">Create Your <span>Custom T-Shirt</span></div>
            <div class="nav-links">
                <a href="index.html">Design</a>
                <a href="track.html">Track My Order</a>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="main-content">
            <div class="design-area">
                <div class="t-shirt-container">
                    <div id="t-shirt-preview">
                        <!-- ØµÙˆØ±Ø© Ø§Ù„ØªÙŠØ´ÙŠØ±Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
                        <svg class="t-shirt-base" id="t-shirt-base" viewBox="0 0 300 400">
                            <path id="tshirt-body" d="M50,80 Q150,20 250,80 L250,350 Q150,380 50,350 Z" fill="#ffffff" stroke="#bdc3c7" stroke-width="2"/>
                            <path d="M100,80 Q150,50 200,80" fill="none" stroke="#bdc3c7" stroke-width="2"/>
                        </svg>
                        <canvas id="design-canvas" width="300" height="400"></canvas>
                    </div>
                </div>
            </div>

            <div class="controls">
                <div class="control-group">
                    <h3>T-Shirt Color</h3>
                    <div class="color-options">
                        <div class="color-option active" style="background-color: #ffffff;" data-color="#ffffff"></div>
                        <div class="color-option" style="background-color: #000000;" data-color="#000000"></div>
                        <div class="color-option" style="background-color: #7f8c8d;" data-color="#7f8c8d"></div>
                        <div class="color-option" style="background-color: #e74c3c;" data-color="#e74c3c"></div>
                        <div class="color-option" style="background-color: #3498db;" data-color="#3498db"></div>
                        <div class="color-option" style="background-color: #2ecc71;" data-color="#2ecc71"></div>
                    </div>
                </div>

                <div class="control-group">
                    <h3>Upload Your Design</h3>
                    <div class="upload-area" id="upload-trigger">
                        <i>ğŸ“</i>
                        <p>Click to upload your design</p>
                        <p style="font-size: 0.9rem; color: #666;">Supports PNG, JPG, WEBP up to 50MB</p>
                        <img id="design-preview" alt="Design Preview">
                        <div class="file-info" id="file-info">
                            <strong>File Info:</strong>
                            <div id="file-details"></div>
                        </div>
                        <div class="progress-bar" id="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <div class="upload-status" id="upload-status"></div>
                        <input type="file" id="design-upload" accept=".png,.jpg,.jpeg,.webp">
                    </div>
                </div>

                <div class="control-group">
                    <h3>Design Size</h3>
                    <div class="size-controls">
                        <button class="btn" id="zoom-out">-</button>
                        <span id="zoom-level">100%</span>
                        <button class="btn" id="zoom-in">+</button>
                    </div>
                    <div class="zoom-slider-container">
                        <input type="range" min="1" max="500" value="100" class="zoom-slider" id="zoom-slider">
                        <div class="zoom-values">
                            <span>1%</span>
                            <span>100%</span>
                            <span>500%</span>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <h3>Design Placement</h3>
                    <div class="placement-controls">
                        <button class="btn btn-outline active" id="front-btn">Front</button>
                        <button class="btn btn-outline" id="back-btn">Back</button>
                    </div>
                </div>

                <button class="btn btn-accent" id="reset-btn">Reset Design</button>
            </div>
        </div>

        <div class="form-section">
            <h2>Submit Your Design</h2>
            <form id="design-form">
                <div class="form-group">
                    <label for="name">Your Name *</label>
                    <input type="text" id="name" required>
                </div>
                <div class="form-group">
                    <label for="email">Your Email *</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number *</label>
                    <input type="tel" id="phone" required>
                </div>
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Submitting your design...</p>
                </div>
                <button type="submit" class="btn btn-accent submit-btn" id="submit-btn">Submit My Design</button>
            </form>
            <p style="text-align: center; margin-top: 15px; color: #666;">
                After submitting, you can <a href="track.html" style="color: var(--primary-color);">track your order here</a>
            </p>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>&copy; 2023 Create Your Custom T-Shirt. All rights reserved.</p>
        </div>
    </footer>

    <div class="notification" id="notification"></div>

    <script>
        // Ø±Ø§Ø¨Ø· Cloudflare Worker Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
        const WORKER_URL = 'https://rapid-river-f98b.mohammed1990sid.workers.dev/';

document.addEventListener('DOMContentLoaded', function() {
    // Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    const tshirtBody = document.getElementById('tshirt-body');
    const designCanvas = document.getElementById('design-canvas');
    const ctx = designCanvas.getContext('2d');
    const designPreview = document.getElementById('design-preview');
    const designForm = document.getElementById('design-form');
    const loadingElement = document.getElementById('loading');
    const submitBtn = document.getElementById('submit-btn');
    
    // Ø®ØµØ§Ø¦Øµ Ø§Ù„ØªØµÙ…ÙŠÙ…
    let designImage = null;
    let designScale = 1.0;
    let designX = 150;
    let designY = 200;
    let isDragging = false;
    let dragStartX = 0;
    let dragStartY = 0;
    let designOffsetX = 0;
    let designOffsetY = 0;
    let placement = 'front';
    
    // Ø±Ø§Ø¨Ø· Google Apps Script
    const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxyz/exec'; // Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ø±Ø§Ø¨Ø·Ùƒ

    // Ø±Ø³Ù… Ø§Ù„ØªØµÙ…ÙŠÙ…
    function drawDesign() {
        ctx.clearRect(0, 0, designCanvas.width, designCanvas.height);
        
        if (designImage) {
            const scaledWidth = designImage.width * designScale;
            const scaledHeight = designImage.height * designScale;
            
            ctx.drawImage(
                designImage, 
                designX - scaledWidth / 2, 
                designY - scaledHeight / 2, 
                scaledWidth, 
                scaledHeight
            );
            
            // Ø±Ø³Ù… Ø¥Ø·Ø§Ø± Ø­ÙˆÙ„ Ø§Ù„ØªØµÙ…ÙŠÙ… Ù„ØªÙˆØ¶ÙŠØ­ Ø§Ù„Ø­Ø¯ÙˆØ¯
            ctx.strokeStyle = '#e74c3c';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.strokeRect(
                designX - scaledWidth / 2, 
                designY - scaledHeight / 2, 
                scaledWidth, 
                scaledHeight
            );
            ctx.setLineDash([]);
        }
    }

    // ØªØ­Ø¯ÙŠØ« Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙƒØ¨ÙŠØ±
    function updateZoomLevel() {
        const zoomLevel = document.getElementById('zoom-level');
        zoomLevel.textContent = Math.round(designScale * 100) + '%';
        document.getElementById('zoom-slider').value = designScale * 100;
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¶Ø¹
        updatePositionInfo();
    }

    // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆØ¶Ø¹ ÙˆØ§Ù„Ø­Ø¬Ù…
    function updatePositionInfo() {
        const infoElement = document.getElementById('position-info') || createPositionInfoElement();
        if (designImage) {
            const scaledWidth = Math.round(designImage.width * designScale);
            const scaledHeight = Math.round(designImage.height * designScale);
            
            infoElement.innerHTML = `
                <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ…:</strong><br>
                Ø§Ù„Ù…ÙˆØ¶Ø¹: X=${Math.round(designX)}, Y=${Math.round(designY)}<br>
                Ø§Ù„Ø­Ø¬Ù…: ${scaledWidth} Ã— ${scaledHeight} Ø¨ÙƒØ³Ù„<br>
                Ø§Ù„Ù…Ù‚ÙŠØ§Ø³: ${(designScale * 100).toFixed(1)}%
            `;
        }
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
    function createPositionInfoElement() {
        const infoDiv = document.createElement('div');
        infoDiv.id = 'position-info';
        infoDiv.style.cssText = `
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9rem;
            border-right: 4px solid #3498db;
        `;
        document.querySelector('.design-area').appendChild(infoDiv);
        return infoDiv;
    }

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø³Ø­Ø¨ ÙˆØ§Ù„Ø¥ÙÙ„Ø§Øª
    designCanvas.addEventListener('mousedown', startDrag);
    designCanvas.addEventListener('mousemove', drag);
    designCanvas.addEventListener('mouseup', endDrag);
    designCanvas.addEventListener('mouseleave', endDrag);

    function startDrag(e) {
        if (!designImage) return;
        
        const rect = designCanvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        const scaledWidth = designImage.width * designScale;
        const scaledHeight = designImage.height * designScale;
        const designLeft = designX - scaledWidth / 2;
        const designTop = designY - scaledHeight / 2;
        
        if (x >= designLeft && x <= designLeft + scaledWidth && 
            y >= designTop && y <= designTop + scaledHeight) {
            isDragging = true;
            dragStartX = x;
            dragStartY = y;
            designOffsetX = designX;
            designOffsetY = designY;
            designCanvas.style.cursor = 'grabbing';
        }
    }

    function drag(e) {
        if (!isDragging || !designImage) return;
        
        const rect = designCanvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        
        designX = designOffsetX + (x - dragStartX);
        designY = designOffsetY + (y - dragStartY);
        
        // Ø§Ù„Ø­Ø¯ÙˆØ¯ Ù„Ù…Ù†Ø¹ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¹Ù† Ø§Ù„ØªÙŠØ´ÙŠØ±Øª
        const scaledWidth = designImage.width * designScale;
        const scaledHeight = designImage.height * designScale;
        designX = Math.max(scaledWidth/2, Math.min(designX, designCanvas.width - scaledWidth/2));
        designY = Math.max(scaledHeight/2, Math.min(designY, designCanvas.height - scaledHeight/2));
        
        drawDesign();
        updatePositionInfo();
    }

    function endDrag() {
        isDragging = false;
        designCanvas.style.cursor = 'move';
    }

    // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªÙƒØ¨ÙŠØ±
    document.getElementById('zoom-in').addEventListener('click', function() {
        if (designImage) {
            const newScale = Math.min(designScale * 1.2, 5);
            designScale = newScale;
            updateZoomLevel();
            drawDesign();
        }
    });

    document.getElementById('zoom-out').addEventListener('click', function() {
        if (designImage) {
            const newScale = Math.max(designScale / 1.2, 0.1);
            designScale = newScale;
            updateZoomLevel();
            drawDesign();
        }
    });

    document.getElementById('zoom-slider').addEventListener('input', function() {
        if (designImage) {
            designScale = parseInt(this.value) / 100;
            updateZoomLevel();
            drawDesign();
        }
    });

    // Ø±ÙØ¹ Ø§Ù„ØªØµÙ…ÙŠÙ…
    document.getElementById('design-upload').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                designImage = new Image();
                designImage.onload = function() {
                    designPreview.src = event.target.result;
                    designPreview.style.display = 'block';
                    
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ÙˆØ¶Ø¹ ÙˆØ§Ù„Ù…Ù‚ÙŠØ§Ø³
                    designX = 150;
                    designY = 200;
                    designScale = 1.0;
                    
                    updateZoomLevel();
                    drawDesign();
                    updatePositionInfo();
                    
                    showNotification('ØªÙ… Ø±ÙØ¹ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­!');
                };
                designImage.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
    });

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
    designForm.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (!designImage) {
            showNotification('ÙŠØ±Ø¬Ù‰ Ø±ÙØ¹ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø£ÙˆÙ„Ø§Ù‹', true);
            return;
        }

        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;

        if (!name || !email || !phone) {
            showNotification('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', true);
            return;
        }

        loadingElement.style.display = 'block';
        submitBtn.disabled = true;
        submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

        try {
            // Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
            const finalDesign = await captureFinalDesign();
            // Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            const previewImage = await capturePreviewImage();
            
            const formData = {
                name: name,
                email: email,
                phone: phone,
                tshirtColor: tshirtBody.getAttribute('fill'),
                placement: placement,
                designScale: designScale,
                designX: designX,
                designY: designY,
                originalWidth: designImage.width,
                originalHeight: designImage.height,
                designImage: finalDesign,
                previewImage: previewImage,
                timestamp: new Date().toISOString()
            };

            console.log('Sending design data:', {
                position: { x: designX, y: designY },
                scale: designScale,
                size: { width: designImage.width, height: designImage.height }
            });

            const response = await sendToGoogleAppsScript(formData);
            
            if (response.success) {
                showNotification(`âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØµÙ…ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­! Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨: ${response.id}`);
                
                // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨
                setTimeout(() => {
                    showOrderSummary(response, name);
                }, 1000);
                
                designForm.reset();
                resetDesign();
                
            } else {
                throw new Error(response.message);
            }
            
        } catch (error) {
            console.error('Error:', error);
            showNotification('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„: ' + error.message, true);
        } finally {
            loadingElement.style.display = 'none';
            submitBtn.disabled = false;
            submitBtn.textContent = 'Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØµÙ…ÙŠÙ…';
        }
    });

    // Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© (Ø¨Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ©)
    function captureFinalDesign() {
        return new Promise((resolve) => {
            const canvas = document.createElement('canvas');
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¯Ù‚Ø© Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
            canvas.width = designImage.width;
            canvas.height = designImage.height;
            const ctx = canvas.getContext('2d');
            
            // Ø±Ø³Ù… Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£ØµÙ„ÙŠ Ø¨Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ÙƒØ§Ù…Ù„
            ctx.drawImage(designImage, 0, 0, canvas.width, canvas.height);
            
            resolve(canvas.toDataURL('image/png', 1.0)); // Ø¬ÙˆØ¯Ø© 100%
        });
    }

    // Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (Ø§Ù„ØªÙŠØ´ÙŠØ±Øª ÙƒØ§Ù…Ù„)
    function capturePreviewImage() {
        return new Promise((resolve) => {
            const canvas = document.createElement('canvas');
            canvas.width = designCanvas.width;
            canvas.height = designCanvas.height;
            const ctx = canvas.getContext('2d');
            
            // Ø±Ø³Ù… Ø§Ù„ØªÙŠØ´ÙŠØ±Øª
            ctx.fillStyle = tshirtBody.getAttribute('fill');
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Ø±Ø³Ù… Ø§Ù„ØªØµÙ…ÙŠÙ…
            if (designImage) {
                const scaledWidth = designImage.width * designScale;
                const scaledHeight = designImage.height * designScale;
                
                ctx.drawImage(
                    designImage,
                    designX - scaledWidth / 2,
                    designY - scaledHeight / 2,
                    scaledWidth,
                    scaledHeight
                );
            }
            
            resolve(canvas.toDataURL('image/png', 0.8));
        });
    }

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Google Apps Script
    function sendToGoogleAppsScript(data) {
        return new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();
            xhr.open('POST', GOOGLE_SCRIPT_URL, true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            
            xhr.onload = function() {
                if (xhr.status === 200) {
                    try {
                        resolve(JSON.parse(xhr.responseText));
                    } catch (e) {
                        reject(new Error('Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…'));
                    }
                } else {
                    reject(new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø®Ø§Ø¯Ù…: ${xhr.status}`));
                }
            };
            
            xhr.onerror = function() {
                reject(new Error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©'));
            };
            
            xhr.timeout = 30000;
            xhr.ontimeout = function() {
                reject(new Error('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„'));
            };
            
            xhr.send(JSON.stringify(data));
        });
    }

    // Ø¹Ø±Ø¶ Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨
    function showOrderSummary(response, customerName) {
        const summary = `
            <div style="background: #d4edda; padding: 15px; border-radius: 5px; margin: 10px 0;">
                <h3>âœ… ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­!</h3>
                <p><strong>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</strong> ${customerName}</p>
                <p><strong>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:</strong> ${response.id}</p>
                <p><strong>Ù…ÙˆØ¶Ø¹ Ø§Ù„ØªØµÙ…ÙŠÙ…:</strong> X=${Math.round(designX)}, Y=${Math.round(designY)}</p>
                <p><strong>Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„ØªØµÙ…ÙŠÙ…:</strong> ${(designScale * 100).toFixed(1)}%</p>
                <p><strong>Ø§Ù„Ø¬Ø§Ù†Ø¨:</strong> ${placement === 'front' ? 'Ø£Ù…Ø§Ù…ÙŠ' : 'Ø®Ù„ÙÙŠ'}</p>
                <p><strong>Ù„ÙˆÙ† Ø§Ù„ØªÙŠØ´ÙŠØ±Øª:</strong> <span style="display:inline-block; width:20px; height:20px; background:${tshirtBody.getAttribute('fill')}; border:1px solid #ccc;"></span></p>
            </div>
        `;
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù„Ø®Øµ ÙÙˆÙ‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
        const formSection = document.querySelector('.form-section');
        const existingSummary = formSection.querySelector('.order-summary');
        if (existingSummary) {
            existingSummary.remove();
        }
        
        const summaryDiv = document.createElement('div');
        summaryDiv.className = 'order-summary';
        summaryDiv.innerHTML = summary;
        formSection.insertBefore(summaryDiv, formSection.firstChild);
    }

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØµÙ…ÙŠÙ…
    function resetDesign() {
        designImage = null;
        designScale = 1.0;
        designX = 150;
        designY = 200;
        designPreview.style.display = 'none';
        document.getElementById('design-upload').value = '';
        updateZoomLevel();
        drawDesign();
        updatePositionInfo();
        
        const summary = document.querySelector('.order-summary');
        if (summary) {
            summary.remove();
        }
    }

    // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    function showNotification(message, isError = false) {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.className = 'notification' + (isError ? ' error' : '');
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 5000);
    }

    // Ø§Ù„Ø±Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ÙŠ
    drawDesign();
    createPositionInfoElement();
});
    </script>
</body>
</html>
